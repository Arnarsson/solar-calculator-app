---
phase: 01-foundation
plan: 06
type: execute
wave: 3
depends_on: ["01-04"]
files_modified:
  - components/calculator/results/SummaryCards.tsx
  - components/calculator/results/ProjectionChart.tsx
  - components/calculator/results/CostBreakdown.tsx
  - components/calculator/results/TaxComparison.tsx
  - components/calculator/CalculatorResults.tsx
autonomous: true

must_haves:
  truths:
    - "User sees payback period, annual savings, and total cost in summary cards"
    - "User sees 25-year projection chart with nominal and real savings"
    - "User sees transparent cost breakdown with VAT"
    - "User can compare tax scenarios (with/without deduction)"
  artifacts:
    - path: "components/calculator/results/SummaryCards.tsx"
      provides: "Key metrics at a glance"
      min_lines: 50
    - path: "components/calculator/results/ProjectionChart.tsx"
      provides: "25-year savings visualization"
      min_lines: 80
    - path: "components/calculator/CalculatorResults.tsx"
      provides: "Results container component"
  key_links:
    - from: "components/calculator/results/ProjectionChart.tsx"
      to: "recharts"
      via: "LineChart component"
      pattern: "import.*from.*recharts"
    - from: "components/calculator/CalculatorResults.tsx"
      to: "@tanstack/react-query"
      via: "useQuery hook"
      pattern: "useQuery"
---

<objective>
Create calculator output components showing summary cards, charts, and detailed breakdowns.

Purpose: Transform calculation results into actionable insights. Summary cards provide instant gratification (payback period!), charts show the long-term value, and breakdowns build trust through transparency.

Output: Complete results UI with all Phase 1 calculation outputs visualized.
</objective>

<execution_context>
@/home/sven/.claude/get-shit-done/workflows/execute-plan.md
@/home/sven/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation-and-core-calculations/CONTEXT.md

@lib/utils/serialization.ts (serialized types from Plan 04)
@components/charts/production-chart.tsx (existing chart pattern)
@components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create summary cards for key metrics</name>
  <files>
    components/calculator/results/SummaryCards.tsx
  </files>
  <action>
Create components/calculator/results/SummaryCards.tsx:

```typescript
'use client';

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { TrendingUp, Calendar, Wallet, Leaf } from 'lucide-react';
import type {
  SerializedPaybackResult,
  SerializedSetupCostResult,
} from '@/lib/utils/serialization';

interface SummaryCardsProps {
  payback: SerializedPaybackResult | null;
  setupCost: SerializedSetupCostResult | null;
  annualProductionKwh: string | null;
  isLoading?: boolean;
}

function formatDKK(value: string | null): string {
  if (!value) return '—';
  const num = parseFloat(value);
  return num.toLocaleString('da-DK', { maximumFractionDigits: 0 }) + ' DKK';
}

function formatYears(value: string | null): string {
  if (!value) return '—';
  const years = parseFloat(value);
  if (years < 1) return `${Math.round(years * 12)} måneder`;
  return `${years.toFixed(1)} år`;
}

function formatKwh(value: string | null): string {
  if (!value) return '—';
  const kwh = parseFloat(value);
  return kwh.toLocaleString('da-DK', { maximumFractionDigits: 0 }) + ' kWh';
}

export function SummaryCards({
  payback,
  setupCost,
  annualProductionKwh,
  isLoading,
}: SummaryCardsProps) {
  // CO2 savings estimate (0.5 kg/kWh Danish grid average)
  const co2SavedKg = annualProductionKwh
    ? (parseFloat(annualProductionKwh) * 0.5).toFixed(0)
    : null;

  const cards = [
    {
      title: 'Tilbagebetalingstid',
      value: formatYears(payback?.paybackYears ?? null),
      subtitle: payback ? `År ${payback.breakEvenYear}` : null,
      icon: Calendar,
      color: 'text-blue-600',
      bgColor: 'bg-blue-50 dark:bg-blue-950',
    },
    {
      title: 'Årlig besparelse',
      value: formatDKK(payback?.annualSavings ?? null),
      subtitle: payback
        ? `${formatDKK(payback.selfConsumptionSavings)} egetforbrug + ${formatDKK(payback.gridExportEarnings)} salg`
        : null,
      icon: Wallet,
      color: 'text-green-600',
      bgColor: 'bg-green-50 dark:bg-green-950',
    },
    {
      title: 'Total investering',
      value: formatDKK(setupCost?.totalWithVat ?? null),
      subtitle: setupCost ? `inkl. ${formatDKK(setupCost.vatAmount)} moms` : null,
      icon: TrendingUp,
      color: 'text-purple-600',
      bgColor: 'bg-purple-50 dark:bg-purple-950',
    },
    {
      title: 'Årlig produktion',
      value: formatKwh(annualProductionKwh),
      subtitle: co2SavedKg ? `~${parseInt(co2SavedKg).toLocaleString('da-DK')} kg CO₂ sparet/år` : null,
      icon: Leaf,
      color: 'text-emerald-600',
      bgColor: 'bg-emerald-50 dark:bg-emerald-950',
    },
  ];

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      {cards.map((card) => (
        <Card key={card.title} className={`${isLoading ? 'opacity-50' : ''}`}>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-muted-foreground">
              {card.title}
            </CardTitle>
            <div className={`p-2 rounded-md ${card.bgColor}`}>
              <card.icon className={`h-4 w-4 ${card.color}`} />
            </div>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{card.value}</div>
            {card.subtitle && (
              <p className="text-xs text-muted-foreground mt-1">
                {card.subtitle}
              </p>
            )}
          </CardContent>
        </Card>
      ))}
    </div>
  );
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` - SummaryCards compiles without errors.
  </verify>
  <done>
Summary cards display 4 key metrics: payback period, annual savings, total investment, and annual production. Each card includes a subtitle with additional context and uses Danish number formatting.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create 25-year projection chart with dual lines</name>
  <files>
    components/calculator/results/ProjectionChart.tsx
  </files>
  <action>
Create components/calculator/results/ProjectionChart.tsx:

```typescript
'use client';

import { useState } from 'react';
import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  ReferenceLine,
} from 'recharts';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ChevronDown, ChevronUp, Info } from 'lucide-react';
import type { SerializedProjectionResult } from '@/lib/utils/serialization';

interface ProjectionChartProps {
  projection: SerializedProjectionResult | null;
  isLoading?: boolean;
}

type ViewMode = 'cumulative' | 'annual';

function formatDKK(value: number): string {
  return value.toLocaleString('da-DK', { maximumFractionDigits: 0 });
}

export function ProjectionChart({ projection, isLoading }: ProjectionChartProps) {
  const [viewMode, setViewMode] = useState<ViewMode>('cumulative');
  const [showTable, setShowTable] = useState(false);

  if (!projection) {
    return (
      <Card className={isLoading ? 'opacity-50' : ''}>
        <CardContent className="h-80 flex items-center justify-center text-muted-foreground">
          Indtast dine oplysninger for at se 25-års fremskrivning
        </CardContent>
      </Card>
    );
  }

  // Prepare chart data
  const chartData = projection.years.map((year) => ({
    year: year.year,
    cumulativeNominal: parseFloat(year.cumulativeNominal),
    cumulativeReal: parseFloat(year.cumulativeReal),
    annualNominal: parseFloat(year.netSavingsNominal),
    annualReal: parseFloat(year.netSavingsReal),
    productionKwh: parseFloat(year.productionKwh),
  }));

  // Find break-even point for reference line
  const breakEvenYear = projection.summary.breakEvenYearNominal;

  // Custom tooltip
  const CustomTooltip = ({ active, payload, label }: any) => {
    if (!active || !payload || !payload.length) return null;

    return (
      <div className="bg-background border rounded-lg p-3 shadow-lg">
        <p className="font-medium mb-2">År {label}</p>
        {payload.map((entry: any) => (
          <p key={entry.name} className="text-sm" style={{ color: entry.color }}>
            {entry.name}: {formatDKK(entry.value)} DKK
          </p>
        ))}
      </div>
    );
  };

  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between">
        <CardTitle>25-års fremskrivning</CardTitle>
        <Tabs value={viewMode} onValueChange={(v) => setViewMode(v as ViewMode)}>
          <TabsList>
            <TabsTrigger value="cumulative">Kumulativ</TabsTrigger>
            <TabsTrigger value="annual">Årlig</TabsTrigger>
          </TabsList>
        </Tabs>
      </CardHeader>
      <CardContent>
        <div className="h-80">
          <ResponsiveContainer width="100%" height="100%">
            <LineChart data={chartData} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
              <CartesianGrid strokeDasharray="3 3" className="stroke-muted" />
              <XAxis
                dataKey="year"
                tickFormatter={(v) => `År ${v}`}
                tick={{ fontSize: 12 }}
              />
              <YAxis
                tickFormatter={(v) => `${(v / 1000).toFixed(0)}k`}
                tick={{ fontSize: 12 }}
              />
              <Tooltip content={<CustomTooltip />} />
              <Legend />

              {/* Break-even reference line */}
              {viewMode === 'cumulative' && breakEvenYear > 0 && (
                <>
                  <ReferenceLine y={0} stroke="#666" strokeDasharray="3 3" />
                  <ReferenceLine
                    x={breakEvenYear}
                    stroke="#22c55e"
                    strokeDasharray="5 5"
                    label={{
                      value: `Break-even år ${breakEvenYear}`,
                      position: 'top',
                      fill: '#22c55e',
                      fontSize: 12,
                    }}
                  />
                </>
              )}

              {viewMode === 'cumulative' ? (
                <>
                  <Line
                    type="monotone"
                    dataKey="cumulativeNominal"
                    name="Nominel (faktisk DKK)"
                    stroke="#3b82f6"
                    strokeWidth={2}
                    dot={false}
                    activeDot={{ r: 6 }}
                  />
                  <Line
                    type="monotone"
                    dataKey="cumulativeReal"
                    name="Real (nutidens værdi)"
                    stroke="#8b5cf6"
                    strokeWidth={2}
                    strokeDasharray="5 5"
                    dot={false}
                    activeDot={{ r: 6 }}
                  />
                </>
              ) : (
                <>
                  <Line
                    type="monotone"
                    dataKey="annualNominal"
                    name="Årlig besparelse (nominel)"
                    stroke="#3b82f6"
                    strokeWidth={2}
                    dot={false}
                    activeDot={{ r: 6 }}
                  />
                  <Line
                    type="monotone"
                    dataKey="annualReal"
                    name="Årlig besparelse (real)"
                    stroke="#8b5cf6"
                    strokeWidth={2}
                    strokeDasharray="5 5"
                    dot={false}
                    activeDot={{ r: 6 }}
                  />
                </>
              )}
            </LineChart>
          </ResponsiveContainer>
        </div>

        {/* Summary stats */}
        <div className="mt-4 grid grid-cols-3 gap-4 text-center">
          <div>
            <p className="text-2xl font-bold text-primary">
              {formatDKK(parseFloat(projection.summary.totalSavingsNominal))} DKK
            </p>
            <p className="text-sm text-muted-foreground">Total besparelse (25 år)</p>
          </div>
          <div>
            <p className="text-2xl font-bold text-purple-600">
              {formatDKK(parseFloat(projection.summary.totalSavingsReal))} DKK
            </p>
            <p className="text-sm text-muted-foreground">I nutidens værdi</p>
          </div>
          <div>
            <p className="text-2xl font-bold text-green-600">
              {parseFloat(projection.summary.roi25Year).toFixed(0)}%
            </p>
            <p className="text-sm text-muted-foreground">Samlet afkast (ROI)</p>
          </div>
        </div>

        {/* Expandable table */}
        <div className="mt-4">
          <Button
            variant="outline"
            size="sm"
            onClick={() => setShowTable(!showTable)}
            className="w-full"
          >
            {showTable ? (
              <>
                <ChevronUp className="h-4 w-4 mr-2" /> Skjul årsdata
              </>
            ) : (
              <>
                <ChevronDown className="h-4 w-4 mr-2" /> Vis årsdata
              </>
            )}
          </Button>

          {showTable && (
            <div className="mt-4 max-h-96 overflow-auto">
              <table className="w-full text-sm">
                <thead className="sticky top-0 bg-background">
                  <tr className="border-b">
                    <th className="text-left p-2">År</th>
                    <th className="text-right p-2">Produktion</th>
                    <th className="text-right p-2">Besparelse</th>
                    <th className="text-right p-2">Kumulativ</th>
                  </tr>
                </thead>
                <tbody>
                  {projection.years.map((year) => (
                    <tr
                      key={year.year}
                      className={`border-b ${
                        year.year === breakEvenYear ? 'bg-green-50 dark:bg-green-950' : ''
                      }`}
                    >
                      <td className="p-2">{year.year}</td>
                      <td className="text-right p-2">
                        {parseFloat(year.productionKwh).toLocaleString('da-DK', {
                          maximumFractionDigits: 0,
                        })}{' '}
                        kWh
                      </td>
                      <td className="text-right p-2">
                        {formatDKK(parseFloat(year.netSavingsNominal))} DKK
                      </td>
                      <td className="text-right p-2">
                        <span
                          className={
                            parseFloat(year.cumulativeNominal) >= 0
                              ? 'text-green-600'
                              : 'text-red-600'
                          }
                        >
                          {formatDKK(parseFloat(year.cumulativeNominal))} DKK
                        </span>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>

        {/* Methodology note */}
        <div className="mt-4 flex items-start gap-2 text-xs text-muted-foreground">
          <Info className="h-4 w-4 shrink-0 mt-0.5" />
          <p>
            <span className="font-medium">Nominel</span> viser faktiske DKK.{' '}
            <span className="font-medium">Real</span> er justeret for inflation, så du kan
            sammenligne med nutidens priser.
          </p>
        </div>
      </CardContent>
    </Card>
  );
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` - ProjectionChart compiles without errors.
  </verify>
  <done>
25-year projection chart shows dual lines for nominal and real savings. Includes toggle between cumulative and annual view, break-even reference line, expandable year-by-year table, and methodology explanation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create cost breakdown and tax comparison components</name>
  <files>
    components/calculator/results/CostBreakdown.tsx
    components/calculator/results/TaxComparison.tsx
    components/calculator/CalculatorResults.tsx
  </files>
  <action>
Create components/calculator/results/CostBreakdown.tsx:

```typescript
'use client';

import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { ChevronDown, ChevronUp, Calculator } from 'lucide-react';
import type { SerializedSetupCostResult } from '@/lib/utils/serialization';

interface CostBreakdownProps {
  setupCost: SerializedSetupCostResult | null;
  isLoading?: boolean;
}

function formatDKK(value: string): string {
  return parseFloat(value).toLocaleString('da-DK', { maximumFractionDigits: 0 });
}

export function CostBreakdown({ setupCost, isLoading }: CostBreakdownProps) {
  const [showFormula, setShowFormula] = useState(false);

  if (!setupCost) {
    return null;
  }

  const costItems = [
    { label: 'Solpaneler', value: setupCost.panelsCost },
    { label: 'Inverter', value: setupCost.inverterCost },
    { label: 'Installation', value: setupCost.installationCost },
    { label: 'Monteringssæt', value: setupCost.mountingKitCost },
  ];

  // Filter out zero values
  const nonZeroItems = costItems.filter((item) => parseFloat(item.value) > 0);

  return (
    <Card className={isLoading ? 'opacity-50' : ''}>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Calculator className="h-5 w-5" />
          Omkostningsfordeling
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Cost bars */}
        <div className="space-y-3">
          {nonZeroItems.map((item) => {
            const percentage =
              (parseFloat(item.value) / parseFloat(setupCost.subtotal)) * 100;
            return (
              <div key={item.label} className="space-y-1">
                <div className="flex justify-between text-sm">
                  <span>{item.label}</span>
                  <span className="font-medium">{formatDKK(item.value)} DKK</span>
                </div>
                <div className="h-2 bg-muted rounded-full overflow-hidden">
                  <div
                    className="h-full bg-primary rounded-full transition-all duration-500"
                    style={{ width: `${percentage}%` }}
                  />
                </div>
              </div>
            );
          })}
        </div>

        {/* Totals */}
        <div className="border-t pt-4 space-y-2">
          <div className="flex justify-between text-sm">
            <span>Subtotal (ekskl. moms)</span>
            <span>{formatDKK(setupCost.subtotal)} DKK</span>
          </div>
          <div className="flex justify-between text-sm text-muted-foreground">
            <span>Moms (25%)</span>
            <span>{formatDKK(setupCost.vatAmount)} DKK</span>
          </div>
          <div className="flex justify-between font-bold text-lg">
            <span>Total (inkl. moms)</span>
            <span className="text-primary">{formatDKK(setupCost.totalWithVat)} DKK</span>
          </div>
        </div>

        {/* Show formula button */}
        <Button
          variant="ghost"
          size="sm"
          onClick={() => setShowFormula(!showFormula)}
          className="w-full text-muted-foreground"
        >
          {showFormula ? (
            <>
              <ChevronUp className="h-4 w-4 mr-2" /> Skjul beregning
            </>
          ) : (
            <>
              <ChevronDown className="h-4 w-4 mr-2" /> Vis beregning
            </>
          )}
        </Button>

        {showFormula && (
          <div className="bg-muted rounded-md p-4 font-mono text-sm">
            <p className="text-muted-foreground mb-2">// Formel</p>
            <p>Subtotal = Paneler + Inverter + Installation + Montering</p>
            <p>Subtotal = {formatDKK(setupCost.panelsCost)} + {formatDKK(setupCost.inverterCost)} + {formatDKK(setupCost.installationCost)} + {formatDKK(setupCost.mountingKitCost)}</p>
            <p>Subtotal = {formatDKK(setupCost.subtotal)} DKK</p>
            <p className="mt-2">Moms = Subtotal × 25%</p>
            <p>Moms = {formatDKK(setupCost.subtotal)} × 0,25 = {formatDKK(setupCost.vatAmount)} DKK</p>
            <p className="mt-2 font-bold">Total = {formatDKK(setupCost.subtotal)} + {formatDKK(setupCost.vatAmount)} = {formatDKK(setupCost.totalWithVat)} DKK</p>
          </div>
        )}
      </CardContent>
    </Card>
  );
}
```

Create components/calculator/results/TaxComparison.tsx:

```typescript
'use client';

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Info, CheckCircle } from 'lucide-react';
import type { SerializedTaxScenarioResult } from '@/lib/utils/serialization';

interface TaxComparisonProps {
  scenarios: SerializedTaxScenarioResult[] | null;
  isLoading?: boolean;
}

function formatDKK(value: string): string {
  return parseFloat(value).toLocaleString('da-DK', { maximumFractionDigits: 0 });
}

function formatYears(value: string): string {
  const years = parseFloat(value);
  return years.toFixed(1);
}

export function TaxComparison({ scenarios, isLoading }: TaxComparisonProps) {
  if (!scenarios || scenarios.length === 0) {
    return null;
  }

  const noTax = scenarios.find((s) => s.scenario === 'NO_TAX');
  const withTax = scenarios.find((s) => s.scenario === 'LABOR_DEDUCTION');

  if (!noTax || !withTax) {
    return null;
  }

  const savings = parseFloat(noTax.effectiveCost) - parseFloat(withTax.effectiveCost);
  const yearsSaved = parseFloat(noTax.effectivePaybackYears) - parseFloat(withTax.effectivePaybackYears);

  return (
    <Card className={isLoading ? 'opacity-50' : ''}>
      <CardHeader>
        <CardTitle>Skattescenarier</CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Comparison table */}
        <div className="grid grid-cols-2 gap-4">
          {/* Without deduction */}
          <div className="p-4 rounded-lg border">
            <p className="font-medium mb-2">Uden fradrag</p>
            <p className="text-2xl font-bold">{formatDKK(noTax.effectiveCost)} DKK</p>
            <p className="text-sm text-muted-foreground">
              Tilbagebetaling: {formatYears(noTax.effectivePaybackYears)} år
            </p>
          </div>

          {/* With deduction */}
          <div className="p-4 rounded-lg border-2 border-green-500 bg-green-50 dark:bg-green-950">
            <div className="flex items-center gap-2 mb-2">
              <p className="font-medium">Med håndværkerfradrag</p>
              <Badge variant="secondary" className="bg-green-100 text-green-800">
                Anbefalet
              </Badge>
            </div>
            <p className="text-2xl font-bold text-green-700 dark:text-green-300">
              {formatDKK(withTax.effectiveCost)} DKK
            </p>
            <p className="text-sm text-muted-foreground">
              Tilbagebetaling: {formatYears(withTax.effectivePaybackYears)} år
            </p>
          </div>
        </div>

        {/* Savings highlight */}
        <div className="flex items-center gap-3 p-4 bg-green-50 dark:bg-green-950 rounded-lg">
          <CheckCircle className="h-8 w-8 text-green-600" />
          <div>
            <p className="font-medium text-green-800 dark:text-green-200">
              Du sparer {formatDKK(savings.toString())} DKK med håndværkerfradrag
            </p>
            <p className="text-sm text-green-700 dark:text-green-300">
              Tilbagebetalingstiden forkortes med {yearsSaved.toFixed(1)} år
            </p>
          </div>
        </div>

        {/* Assumptions */}
        <div className="flex items-start gap-2 text-sm text-muted-foreground">
          <Info className="h-4 w-4 shrink-0 mt-0.5" />
          <div>
            <p className="font-medium mb-1">Forudsætninger:</p>
            <ul className="space-y-0.5">
              {withTax.assumptions.map((assumption, idx) => (
                <li key={idx}>• {assumption}</li>
              ))}
            </ul>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

Create components/calculator/CalculatorResults.tsx:

```typescript
'use client';

import { useQuery } from '@tanstack/react-query';
import { SummaryCards } from './results/SummaryCards';
import { ProjectionChart } from './results/ProjectionChart';
import { CostBreakdown } from './results/CostBreakdown';
import { TaxComparison } from './results/TaxComparison';
import type { CalculatorInput } from '@/lib/validation/calculator';
import type {
  SerializedPaybackResult,
  SerializedSetupCostResult,
  SerializedProjectionResult,
  SerializedTaxScenarioResult,
} from '@/lib/utils/serialization';

interface CalculationResponse {
  setupCost: SerializedSetupCostResult;
  annualProductionKwh: string;
  productionSource: 'pvgis' | 'estimate';
  payback: SerializedPaybackResult;
  taxScenarios: SerializedTaxScenarioResult[];
}

interface CalculatorResultsProps {
  input: CalculatorInput;
  enabled: boolean;
}

export function CalculatorResults({ input, enabled }: CalculatorResultsProps) {
  // Main calculation query
  const {
    data: calculation,
    isLoading: isCalculating,
    error: calcError,
  } = useQuery<CalculationResponse>({
    queryKey: ['calculation', input],
    queryFn: async () => {
      const res = await fetch('/api/calculate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(input),
      });
      if (!res.ok) throw new Error('Calculation failed');
      return res.json();
    },
    enabled,
    staleTime: 5 * 60 * 1000,
  });

  // 25-year projection query (depends on calculation results)
  const {
    data: projection,
    isLoading: isProjecting,
  } = useQuery<SerializedProjectionResult>({
    queryKey: ['projection', calculation?.setupCost, calculation?.annualProductionKwh],
    queryFn: async () => {
      if (!calculation) throw new Error('No calculation data');

      const res = await fetch('/api/calculate/projection', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          systemCost: parseFloat(calculation.setupCost.totalWithVat),
          annualProductionKwh: parseFloat(calculation.annualProductionKwh),
          electricityRateDkk: input.electricityRateDkk,
          selfConsumptionRate: input.selfConsumptionRate,
          gridFeedInRate: input.electricityRateDkk * 0.8,
          inflationRate: input.inflationRate,
          electricityInflationRate: input.electricityInflationRate,
          maintenanceCostYear1: input.maintenanceCostYear1,
        }),
      });
      if (!res.ok) throw new Error('Projection failed');
      return res.json();
    },
    enabled: !!calculation,
    staleTime: 5 * 60 * 1000,
  });

  const isLoading = isCalculating || isProjecting;

  if (calcError) {
    return (
      <div className="p-4 bg-destructive/10 text-destructive rounded-lg">
        Beregningsfejl: {(calcError as Error).message}
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Summary cards - always visible */}
      <SummaryCards
        payback={calculation?.payback ?? null}
        setupCost={calculation?.setupCost ?? null}
        annualProductionKwh={calculation?.annualProductionKwh ?? null}
        isLoading={isLoading}
      />

      {/* 25-year projection chart */}
      <ProjectionChart projection={projection ?? null} isLoading={isLoading} />

      {/* Details grid */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <CostBreakdown setupCost={calculation?.setupCost ?? null} isLoading={isLoading} />
        <TaxComparison scenarios={calculation?.taxScenarios ?? null} isLoading={isLoading} />
      </div>

      {/* Data source indicator */}
      {calculation?.productionSource && (
        <p className="text-xs text-muted-foreground text-center">
          Produktionsestimat fra:{' '}
          {calculation.productionSource === 'pvgis'
            ? 'EU PVGIS (satellitdata)'
            : 'Beregning baseret på tagareal'}
        </p>
      )}
    </div>
  );
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` - all result components compile without errors.
Run `npm run build` - build completes successfully.
  </verify>
  <done>
Calculator results container orchestrates data fetching and renders all output components. Cost breakdown shows visual bars with "Show calculation" formula transparency. Tax comparison highlights savings with clear recommended option.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. SummaryCards displays 4 key metrics with Danish formatting
3. ProjectionChart shows 25 years with dual nominal/real lines
4. CostBreakdown has expandable formula view for transparency
5. TaxComparison highlights savings from deduction
6. CalculatorResults fetches from both /api/calculate and /api/calculate/projection
</verification>

<success_criteria>
- Summary cards show payback, savings, cost, and production at a glance
- 25-year chart supports cumulative and annual view modes
- Break-even year highlighted on chart
- Cost breakdown shows visual distribution and VAT calculation
- Tax scenarios compare with/without deduction clearly
- All components handle loading states gracefully
- Formula transparency per FIN-06 ("Show calculation" buttons)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-core-calculations/01-06-SUMMARY.md`
</output>
