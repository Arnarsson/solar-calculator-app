---
phase: 01-foundation
plan: 05
type: execute
wave: 3
depends_on: ["01-04"]
files_modified:
  - components/calculator/CalculatorTabs.tsx
  - components/calculator/tabs/EssentialTab.tsx
  - components/calculator/tabs/EnergyTab.tsx
  - components/calculator/tabs/SystemTab.tsx
  - components/calculator/tabs/AdvancedTab.tsx
  - components/calculator/LocationInput.tsx
  - components/calculator/RoofInput.tsx
  - hooks/use-calculator-form.ts
  - lib/validation/calculator.ts
autonomous: true

must_haves:
  truths:
    - "User can input location via lat/long with DK coordinate validation"
    - "User can input roof details (area, orientation, tilt) with visual helpers"
    - "User can input electricity rate and system costs"
    - "Inputs are organized in tabbed interface (Essential -> Energy -> System -> Advanced)"
  artifacts:
    - path: "components/calculator/CalculatorTabs.tsx"
      provides: "Main tabbed calculator interface"
      min_lines: 50
    - path: "hooks/use-calculator-form.ts"
      provides: "Form state with debounced updates"
      exports: ["useCalculatorForm"]
    - path: "lib/validation/calculator.ts"
      provides: "Zod schemas for input validation"
      exports: ["calculatorInputSchema"]
  key_links:
    - from: "hooks/use-calculator-form.ts"
      to: "use-debounce"
      via: "useDebouncedCallback"
      pattern: "useDebouncedCallback"
---

<objective>
Create tabbed calculator input interface with form state management and debouncing.

Purpose: Collect all calculation inputs through an organized, progressive interface. Users start with essential inputs (location, roof) and can explore advanced options (tax scenarios) in later tabs. Debounced updates prevent UI lag per DATA-03.

Output: Complete input collection UI with validation, ready to wire to API routes.
</objective>

<execution_context>
@/home/sven/.claude/get-shit-done/workflows/execute-plan.md
@/home/sven/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation-and-core-calculations/CONTEXT.md

@components/ui/tabs.tsx (existing shadcn component)
@components/ui/input.tsx
@components/ui/label.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zod validation schemas and form hook with debouncing</name>
  <files>
    lib/validation/calculator.ts
    hooks/use-calculator-form.ts
  </files>
  <action>
Create lib/validation/calculator.ts with Zod schemas:

```typescript
import { z } from 'zod';

// Denmark coordinate bounds
const DENMARK_LAT_MIN = 54.5;
const DENMARK_LAT_MAX = 57.8;
const DENMARK_LON_MIN = 8.0;
const DENMARK_LON_MAX = 15.2;

export const locationSchema = z.object({
  latitude: z
    .number()
    .min(DENMARK_LAT_MIN, 'Latitude must be within Denmark')
    .max(DENMARK_LAT_MAX, 'Latitude must be within Denmark'),
  longitude: z
    .number()
    .min(DENMARK_LON_MIN, 'Longitude must be within Denmark')
    .max(DENMARK_LON_MAX, 'Longitude must be within Denmark'),
  priceArea: z.enum(['DK1', 'DK2']),
});

export const roofSchema = z.object({
  roofAreaM2: z
    .number()
    .min(10, 'Minimum roof area is 10 m²')
    .max(500, 'Maximum roof area is 500 m²'),
  azimuthDegrees: z
    .number()
    .min(0, 'Azimuth must be 0-360°')
    .max(360, 'Azimuth must be 0-360°'),
  tiltDegrees: z
    .number()
    .min(0, 'Tilt must be 0-90°')
    .max(90, 'Tilt must be 0-90°'),
});

export const energySchema = z.object({
  electricityRateDkk: z
    .number()
    .min(0.5, 'Rate must be at least 0.50 DKK/kWh')
    .max(10, 'Rate seems too high'),
  selfConsumptionRate: z
    .number()
    .min(0.1, 'Self-consumption must be at least 10%')
    .max(1, 'Self-consumption cannot exceed 100%'),
  annualConsumptionKwh: z
    .number()
    .min(1000, 'Minimum consumption is 1,000 kWh')
    .max(50000, 'Maximum consumption is 50,000 kWh')
    .optional(),
});

export const systemCostSchema = z.object({
  panelsCost: z.number().min(0).max(500000),
  inverterCost: z.number().min(0).max(100000),
  installationCost: z.number().min(0).max(200000),
  mountingKitCost: z.number().min(0).max(50000),
});

export const advancedSchema = z.object({
  inflationRate: z.number().min(0).max(0.1).default(0.02),
  electricityInflationRate: z.number().min(0).max(0.15).default(0.03),
  maintenanceCostYear1: z.number().min(0).max(10000).default(1000),
});

// Complete calculator input schema
export const calculatorInputSchema = z.object({
  ...locationSchema.shape,
  ...roofSchema.shape,
  ...energySchema.shape,
  ...systemCostSchema.shape,
  ...advancedSchema.shape,
});

export type CalculatorInput = z.infer<typeof calculatorInputSchema>;

// Default values for new calculator
export const defaultCalculatorInput: CalculatorInput = {
  // Location (Copenhagen default)
  latitude: 55.6761,
  longitude: 12.5683,
  priceArea: 'DK2',

  // Roof (typical Danish house)
  roofAreaM2: 50,
  azimuthDegrees: 180, // South-facing
  tiltDegrees: 35,     // Optimal for Denmark

  // Energy
  electricityRateDkk: 2.50,
  selfConsumptionRate: 0.70,
  annualConsumptionKwh: 5000,

  // System costs (typical 10kW system)
  panelsCost: 50000,
  inverterCost: 20000,
  installationCost: 40000,
  mountingKitCost: 10000,

  // Advanced
  inflationRate: 0.02,
  electricityInflationRate: 0.03,
  maintenanceCostYear1: 1000,
};
```

Create hooks/use-calculator-form.ts with debounced state management:

```typescript
'use client';

import { useState, useCallback, useEffect } from 'react';
import { useDebouncedCallback } from 'use-debounce';
import { useQuery } from '@tanstack/react-query';
import {
  CalculatorInput,
  calculatorInputSchema,
  defaultCalculatorInput,
} from '@/lib/validation/calculator';

interface UseCalculatorFormOptions {
  debounceMs?: number;
  onCalculate?: (input: CalculatorInput) => void;
}

export function useCalculatorForm(options: UseCalculatorFormOptions = {}) {
  const { debounceMs = 500, onCalculate } = options;

  const [input, setInput] = useState<CalculatorInput>(defaultCalculatorInput);
  const [validationErrors, setValidationErrors] = useState<Record<string, string>>({});
  const [isDirty, setIsDirty] = useState(false);

  // Validate input
  const validateInput = useCallback((data: CalculatorInput) => {
    const result = calculatorInputSchema.safeParse(data);
    if (!result.success) {
      const errors: Record<string, string> = {};
      result.error.errors.forEach((err) => {
        const path = err.path.join('.');
        errors[path] = err.message;
      });
      setValidationErrors(errors);
      return false;
    }
    setValidationErrors({});
    return true;
  }, []);

  // Debounced calculation trigger
  const debouncedCalculate = useDebouncedCallback(
    (data: CalculatorInput) => {
      if (validateInput(data)) {
        onCalculate?.(data);
      }
    },
    debounceMs
  );

  // Update a single field
  const updateField = useCallback(
    <K extends keyof CalculatorInput>(field: K, value: CalculatorInput[K]) => {
      setInput((prev) => {
        const next = { ...prev, [field]: value };
        setIsDirty(true);
        debouncedCalculate(next);
        return next;
      });
    },
    [debouncedCalculate]
  );

  // Update multiple fields
  const updateFields = useCallback(
    (updates: Partial<CalculatorInput>) => {
      setInput((prev) => {
        const next = { ...prev, ...updates };
        setIsDirty(true);
        debouncedCalculate(next);
        return next;
      });
    },
    [debouncedCalculate]
  );

  // Reset to defaults
  const reset = useCallback(() => {
    setInput(defaultCalculatorInput);
    setValidationErrors({});
    setIsDirty(false);
  }, []);

  // Auto-detect price area from longitude
  useEffect(() => {
    // DK1 (West) if longitude < 10.5, otherwise DK2 (East)
    const newPriceArea = input.longitude < 10.5 ? 'DK1' : 'DK2';
    if (input.priceArea !== newPriceArea) {
      setInput((prev) => ({ ...prev, priceArea: newPriceArea }));
    }
  }, [input.longitude, input.priceArea]);

  // Query for calculation results
  const {
    data: calculationResult,
    isLoading: isCalculating,
    error: calculationError,
  } = useQuery({
    queryKey: ['calculation', input],
    queryFn: async () => {
      const res = await fetch('/api/calculate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(input),
      });
      if (!res.ok) throw new Error('Calculation failed');
      return res.json();
    },
    enabled: isDirty && Object.keys(validationErrors).length === 0,
    staleTime: 5 * 60 * 1000, // 5 min cache
  });

  return {
    input,
    updateField,
    updateFields,
    reset,
    validationErrors,
    isDirty,
    isCalculating,
    calculationResult,
    calculationError,
  };
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` - validation and hook files compile without errors.
  </verify>
  <done>
Zod validation schemas created for all calculator inputs with Danish-specific constraints. Form hook provides debounced updates (500ms per DATA-03) and TanStack Query integration for API calls.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create tabbed calculator interface with Essential and Energy tabs</name>
  <files>
    components/calculator/CalculatorTabs.tsx
    components/calculator/tabs/EssentialTab.tsx
    components/calculator/tabs/EnergyTab.tsx
    components/calculator/LocationInput.tsx
    components/calculator/RoofInput.tsx
  </files>
  <action>
Create components/calculator/LocationInput.tsx:

```typescript
'use client';

import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';

interface LocationInputProps {
  latitude: number;
  longitude: number;
  priceArea: 'DK1' | 'DK2';
  onLatitudeChange: (value: number) => void;
  onLongitudeChange: (value: number) => void;
  errors?: Record<string, string>;
}

export function LocationInput({
  latitude,
  longitude,
  priceArea,
  onLatitudeChange,
  onLongitudeChange,
  errors,
}: LocationInputProps) {
  return (
    <div className="space-y-4">
      <div className="space-y-2">
        <h3 className="text-lg font-medium">Placering</h3>
        <p className="text-sm text-muted-foreground">
          Indtast koordinater for din adresse. Disse bruges til at estimere solindstråling.
        </p>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="latitude">Breddegrad (Latitude)</Label>
          <Input
            id="latitude"
            type="number"
            step="0.0001"
            min={54.5}
            max={57.8}
            value={latitude}
            onChange={(e) => onLatitudeChange(parseFloat(e.target.value) || 0)}
            placeholder="f.eks. 55.6761"
          />
          {errors?.latitude && (
            <p className="text-sm text-destructive">{errors.latitude}</p>
          )}
        </div>

        <div className="space-y-2">
          <Label htmlFor="longitude">Længdegrad (Longitude)</Label>
          <Input
            id="longitude"
            type="number"
            step="0.0001"
            min={8.0}
            max={15.2}
            value={longitude}
            onChange={(e) => onLongitudeChange(parseFloat(e.target.value) || 0)}
            placeholder="f.eks. 12.5683"
          />
          {errors?.longitude && (
            <p className="text-sm text-destructive">{errors.longitude}</p>
          )}
        </div>
      </div>

      <div className="rounded-md bg-muted p-3">
        <p className="text-sm">
          <span className="font-medium">Prisområde:</span>{' '}
          <span className="text-primary">{priceArea}</span>
          <span className="text-muted-foreground ml-2">
            ({priceArea === 'DK1' ? 'Vestdanmark' : 'Østdanmark'})
          </span>
        </p>
        <p className="text-xs text-muted-foreground mt-1">
          Detekteret automatisk ud fra din placering
        </p>
      </div>
    </div>
  );
}
```

Create components/calculator/RoofInput.tsx:

```typescript
'use client';

import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';

interface RoofInputProps {
  roofAreaM2: number;
  azimuthDegrees: number;
  tiltDegrees: number;
  onAreaChange: (value: number) => void;
  onAzimuthChange: (value: number) => void;
  onTiltChange: (value: number) => void;
  errors?: Record<string, string>;
}

// Compass direction labels
const AZIMUTH_LABELS: Record<number, string> = {
  0: 'Nord',
  45: 'Nordøst',
  90: 'Øst',
  135: 'Sydøst',
  180: 'Syd',
  225: 'Sydvest',
  270: 'Vest',
  315: 'Nordvest',
  360: 'Nord',
};

function getAzimuthLabel(degrees: number): string {
  // Find closest direction
  const normalized = ((degrees % 360) + 360) % 360;
  const directions = Object.keys(AZIMUTH_LABELS).map(Number).sort((a, b) => a - b);

  let closest = directions[0];
  let minDiff = Math.abs(normalized - closest);

  for (const dir of directions) {
    const diff = Math.abs(normalized - dir);
    if (diff < minDiff) {
      minDiff = diff;
      closest = dir;
    }
  }

  return AZIMUTH_LABELS[closest];
}

export function RoofInput({
  roofAreaM2,
  azimuthDegrees,
  tiltDegrees,
  onAreaChange,
  onAzimuthChange,
  onTiltChange,
  errors,
}: RoofInputProps) {
  return (
    <div className="space-y-4">
      <div className="space-y-2">
        <h3 className="text-lg font-medium">Tagdetaljer</h3>
        <p className="text-sm text-muted-foreground">
          Angiv tagets areal og orientering for præcis produktionsberegning.
        </p>
      </div>

      <div className="space-y-4">
        <div className="space-y-2">
          <Label htmlFor="roofArea">Tagareal til solceller (m²)</Label>
          <Input
            id="roofArea"
            type="number"
            min={10}
            max={500}
            value={roofAreaM2}
            onChange={(e) => onAreaChange(parseFloat(e.target.value) || 0)}
            placeholder="f.eks. 50"
          />
          {errors?.roofAreaM2 && (
            <p className="text-sm text-destructive">{errors.roofAreaM2}</p>
          )}
          <p className="text-xs text-muted-foreground">
            Det anvendelige tagareal til montering af solceller
          </p>
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label htmlFor="azimuth">
              Orientering (°)
              <span className="ml-2 text-primary font-normal">
                {getAzimuthLabel(azimuthDegrees)}
              </span>
            </Label>
            <Input
              id="azimuth"
              type="range"
              min={0}
              max={360}
              step={5}
              value={azimuthDegrees}
              onChange={(e) => onAzimuthChange(parseFloat(e.target.value))}
              className="h-2"
            />
            <div className="flex justify-between text-xs text-muted-foreground">
              <span>Nord (0°)</span>
              <span>Syd (180°)</span>
              <span>Nord (360°)</span>
            </div>
            {errors?.azimuthDegrees && (
              <p className="text-sm text-destructive">{errors.azimuthDegrees}</p>
            )}
          </div>

          <div className="space-y-2">
            <Label htmlFor="tilt">
              Taghældning (°)
              <span className="ml-2 text-muted-foreground font-normal">
                {tiltDegrees}°
              </span>
            </Label>
            <Input
              id="tilt"
              type="range"
              min={0}
              max={90}
              step={5}
              value={tiltDegrees}
              onChange={(e) => onTiltChange(parseFloat(e.target.value))}
              className="h-2"
            />
            <div className="flex justify-between text-xs text-muted-foreground">
              <span>Fladt (0°)</span>
              <span>Optimal (35°)</span>
              <span>Lodret (90°)</span>
            </div>
            {errors?.tiltDegrees && (
              <p className="text-sm text-destructive">{errors.tiltDegrees}</p>
            )}
          </div>
        </div>

        <div className="rounded-md bg-blue-50 border border-blue-200 p-3 dark:bg-blue-950 dark:border-blue-800">
          <p className="text-sm text-blue-800 dark:text-blue-200">
            <span className="font-medium">Tip:</span> Sydvendte tage (180°) med 30-40° hældning giver den bedste produktion i Danmark.
          </p>
        </div>
      </div>
    </div>
  );
}
```

Create components/calculator/tabs/EssentialTab.tsx:

```typescript
'use client';

import { LocationInput } from '../LocationInput';
import { RoofInput } from '../RoofInput';
import type { CalculatorInput } from '@/lib/validation/calculator';

interface EssentialTabProps {
  input: CalculatorInput;
  onFieldChange: <K extends keyof CalculatorInput>(field: K, value: CalculatorInput[K]) => void;
  errors?: Record<string, string>;
}

export function EssentialTab({ input, onFieldChange, errors }: EssentialTabProps) {
  return (
    <div className="space-y-8">
      <LocationInput
        latitude={input.latitude}
        longitude={input.longitude}
        priceArea={input.priceArea}
        onLatitudeChange={(v) => onFieldChange('latitude', v)}
        onLongitudeChange={(v) => onFieldChange('longitude', v)}
        errors={errors}
      />

      <hr className="border-border" />

      <RoofInput
        roofAreaM2={input.roofAreaM2}
        azimuthDegrees={input.azimuthDegrees}
        tiltDegrees={input.tiltDegrees}
        onAreaChange={(v) => onFieldChange('roofAreaM2', v)}
        onAzimuthChange={(v) => onFieldChange('azimuthDegrees', v)}
        onTiltChange={(v) => onFieldChange('tiltDegrees', v)}
        errors={errors}
      />
    </div>
  );
}
```

Create components/calculator/tabs/EnergyTab.tsx:

```typescript
'use client';

import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import type { CalculatorInput } from '@/lib/validation/calculator';

interface EnergyTabProps {
  input: CalculatorInput;
  onFieldChange: <K extends keyof CalculatorInput>(field: K, value: CalculatorInput[K]) => void;
  errors?: Record<string, string>;
}

export function EnergyTab({ input, onFieldChange, errors }: EnergyTabProps) {
  return (
    <div className="space-y-6">
      <div className="space-y-2">
        <h3 className="text-lg font-medium">Elpriser og forbrug</h3>
        <p className="text-sm text-muted-foreground">
          Disse værdier bruges til at beregne dine besparelser.
        </p>
      </div>

      <div className="space-y-4">
        <div className="space-y-2">
          <Label htmlFor="electricityRate">Nuværende elpris (DKK/kWh)</Label>
          <Input
            id="electricityRate"
            type="number"
            step="0.01"
            min={0.5}
            max={10}
            value={input.electricityRateDkk}
            onChange={(e) => onFieldChange('electricityRateDkk', parseFloat(e.target.value) || 0)}
            placeholder="f.eks. 2.50"
          />
          {errors?.electricityRateDkk && (
            <p className="text-sm text-destructive">{errors.electricityRateDkk}</p>
          )}
          <p className="text-xs text-muted-foreground">
            Inkl. afgifter og moms. Se din seneste elregning.
          </p>
        </div>

        <div className="space-y-2">
          <Label htmlFor="selfConsumption">
            Egetforbrug
            <span className="ml-2 text-primary font-normal">
              {Math.round(input.selfConsumptionRate * 100)}%
            </span>
          </Label>
          <Input
            id="selfConsumption"
            type="range"
            min={0.1}
            max={1}
            step={0.05}
            value={input.selfConsumptionRate}
            onChange={(e) => onFieldChange('selfConsumptionRate', parseFloat(e.target.value))}
            className="h-2"
          />
          <div className="flex justify-between text-xs text-muted-foreground">
            <span>10% (meget eksport)</span>
            <span>70% (typisk)</span>
            <span>100% (off-grid)</span>
          </div>
          {errors?.selfConsumptionRate && (
            <p className="text-sm text-destructive">{errors.selfConsumptionRate}</p>
          )}
        </div>

        <div className="space-y-2">
          <Label htmlFor="annualConsumption">Årligt elforbrug (kWh) - valgfrit</Label>
          <Input
            id="annualConsumption"
            type="number"
            min={1000}
            max={50000}
            value={input.annualConsumptionKwh ?? ''}
            onChange={(e) => onFieldChange('annualConsumptionKwh', parseFloat(e.target.value) || undefined)}
            placeholder="f.eks. 5000"
          />
          <p className="text-xs text-muted-foreground">
            Bruges til at beregne selvforsyningsgrad
          </p>
        </div>
      </div>

      <div className="rounded-md bg-muted p-4 space-y-2">
        <p className="text-sm font-medium">Forudsætninger</p>
        <ul className="text-sm text-muted-foreground space-y-1">
          <li>• Salg til nettet: 80% af købspris ({(input.electricityRateDkk * 0.8).toFixed(2)} DKK/kWh)</li>
          <li>• Elpriser stiger 3% årligt (kan ændres under Avanceret)</li>
          <li>• Prisområde {input.priceArea} spot-priser</li>
        </ul>
      </div>
    </div>
  );
}
```

Create components/calculator/CalculatorTabs.tsx:

```typescript
'use client';

import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { EssentialTab } from './tabs/EssentialTab';
import { EnergyTab } from './tabs/EnergyTab';
import { SystemTab } from './tabs/SystemTab';
import { AdvancedTab } from './tabs/AdvancedTab';
import { useCalculatorForm } from '@/hooks/use-calculator-form';
import { Loader2 } from 'lucide-react';

export function CalculatorTabs() {
  const {
    input,
    updateField,
    validationErrors,
    isCalculating,
    calculationResult,
  } = useCalculatorForm();

  return (
    <div className="w-full">
      <Tabs defaultValue="essential" className="w-full">
        <TabsList className="grid w-full grid-cols-4">
          <TabsTrigger value="essential">Grundlæggende</TabsTrigger>
          <TabsTrigger value="energy">Energi</TabsTrigger>
          <TabsTrigger value="system">System</TabsTrigger>
          <TabsTrigger value="advanced">Avanceret</TabsTrigger>
        </TabsList>

        <div className="mt-6 relative">
          {isCalculating && (
            <div className="absolute top-2 right-2 flex items-center gap-2 text-sm text-muted-foreground">
              <Loader2 className="h-4 w-4 animate-spin" />
              Beregner...
            </div>
          )}

          <TabsContent value="essential" className="mt-0">
            <EssentialTab
              input={input}
              onFieldChange={updateField}
              errors={validationErrors}
            />
          </TabsContent>

          <TabsContent value="energy" className="mt-0">
            <EnergyTab
              input={input}
              onFieldChange={updateField}
              errors={validationErrors}
            />
          </TabsContent>

          <TabsContent value="system" className="mt-0">
            <SystemTab
              input={input}
              onFieldChange={updateField}
              errors={validationErrors}
            />
          </TabsContent>

          <TabsContent value="advanced" className="mt-0">
            <AdvancedTab
              input={input}
              onFieldChange={updateField}
              errors={validationErrors}
            />
          </TabsContent>
        </div>
      </Tabs>
    </div>
  );
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` - all components compile without errors.
  </verify>
  <done>
Essential tab shows location and roof inputs with visual sliders and Danish labels. Energy tab collects electricity rate and self-consumption. Tabbed interface ready for remaining tabs.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create System and Advanced tabs</name>
  <files>
    components/calculator/tabs/SystemTab.tsx
    components/calculator/tabs/AdvancedTab.tsx
  </files>
  <action>
Create components/calculator/tabs/SystemTab.tsx:

```typescript
'use client';

import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import type { CalculatorInput } from '@/lib/validation/calculator';

interface SystemTabProps {
  input: CalculatorInput;
  onFieldChange: <K extends keyof CalculatorInput>(field: K, value: CalculatorInput[K]) => void;
  errors?: Record<string, string>;
}

// Default cost estimates per m² (for estimation guidance)
const COST_ESTIMATES = {
  panels: 1000,      // DKK per m²
  inverter: 400,     // DKK per m²
  installation: 800, // DKK per m²
  mounting: 200,     // DKK per m²
};

export function SystemTab({ input, onFieldChange, errors }: SystemTabProps) {
  const totalBeforeVat = input.panelsCost + input.inverterCost + input.installationCost + input.mountingKitCost;
  const vatAmount = totalBeforeVat * 0.25;
  const totalWithVat = totalBeforeVat + vatAmount;

  // Estimate based on roof area
  const estimatedTotal = input.roofAreaM2 * (COST_ESTIMATES.panels + COST_ESTIMATES.inverter + COST_ESTIMATES.installation + COST_ESTIMATES.mounting);

  return (
    <div className="space-y-6">
      <div className="space-y-2">
        <h3 className="text-lg font-medium">Systemomkostninger</h3>
        <p className="text-sm text-muted-foreground">
          Indtast omkostninger fra dit tilbud, eller brug vores estimater.
        </p>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="panelsCost">Solpaneler (DKK)</Label>
          <Input
            id="panelsCost"
            type="number"
            min={0}
            value={input.panelsCost}
            onChange={(e) => onFieldChange('panelsCost', parseFloat(e.target.value) || 0)}
            placeholder="f.eks. 50000"
          />
          <p className="text-xs text-muted-foreground">
            Estimat: {(input.roofAreaM2 * COST_ESTIMATES.panels).toLocaleString('da-DK')} DKK
          </p>
        </div>

        <div className="space-y-2">
          <Label htmlFor="inverterCost">Inverter (DKK)</Label>
          <Input
            id="inverterCost"
            type="number"
            min={0}
            value={input.inverterCost}
            onChange={(e) => onFieldChange('inverterCost', parseFloat(e.target.value) || 0)}
            placeholder="f.eks. 20000"
          />
          <p className="text-xs text-muted-foreground">
            Estimat: {(input.roofAreaM2 * COST_ESTIMATES.inverter).toLocaleString('da-DK')} DKK
          </p>
        </div>

        <div className="space-y-2">
          <Label htmlFor="installationCost">Installation (DKK)</Label>
          <Input
            id="installationCost"
            type="number"
            min={0}
            value={input.installationCost}
            onChange={(e) => onFieldChange('installationCost', parseFloat(e.target.value) || 0)}
            placeholder="f.eks. 40000"
          />
          <p className="text-xs text-muted-foreground">
            Estimat: {(input.roofAreaM2 * COST_ESTIMATES.installation).toLocaleString('da-DK')} DKK
          </p>
        </div>

        <div className="space-y-2">
          <Label htmlFor="mountingKitCost">Monteringssæt (DKK)</Label>
          <Input
            id="mountingKitCost"
            type="number"
            min={0}
            value={input.mountingKitCost}
            onChange={(e) => onFieldChange('mountingKitCost', parseFloat(e.target.value) || 0)}
            placeholder="f.eks. 10000"
          />
          <p className="text-xs text-muted-foreground">
            Estimat: {(input.roofAreaM2 * COST_ESTIMATES.mounting).toLocaleString('da-DK')} DKK
          </p>
        </div>
      </div>

      {/* Cost Summary */}
      <div className="rounded-md border p-4 space-y-2">
        <div className="flex justify-between text-sm">
          <span>Subtotal (ekskl. moms)</span>
          <span>{totalBeforeVat.toLocaleString('da-DK')} DKK</span>
        </div>
        <div className="flex justify-between text-sm text-muted-foreground">
          <span>Moms (25%)</span>
          <span>{vatAmount.toLocaleString('da-DK')} DKK</span>
        </div>
        <hr className="border-border" />
        <div className="flex justify-between font-medium">
          <span>Total (inkl. moms)</span>
          <span className="text-primary">{totalWithVat.toLocaleString('da-DK')} DKK</span>
        </div>
      </div>

      <div className="rounded-md bg-muted p-3">
        <p className="text-sm text-muted-foreground">
          <span className="font-medium">Tip:</span> Typisk pris for et {input.roofAreaM2} m² anlæg er ca. {estimatedTotal.toLocaleString('da-DK')} DKK (ekskl. moms). Brug dette som udgangspunkt og opdater med faktiske tilbud.
        </p>
      </div>
    </div>
  );
}
```

Create components/calculator/tabs/AdvancedTab.tsx:

```typescript
'use client';

import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import type { CalculatorInput } from '@/lib/validation/calculator';

interface AdvancedTabProps {
  input: CalculatorInput;
  onFieldChange: <K extends keyof CalculatorInput>(field: K, value: CalculatorInput[K]) => void;
  errors?: Record<string, string>;
}

export function AdvancedTab({ input, onFieldChange, errors }: AdvancedTabProps) {
  return (
    <div className="space-y-6">
      <div className="space-y-2">
        <h3 className="text-lg font-medium">Avancerede indstillinger</h3>
        <p className="text-sm text-muted-foreground">
          Juster antagelser for 25-års fremskrivningen.
        </p>
      </div>

      <div className="space-y-4">
        <div className="space-y-2">
          <Label htmlFor="inflationRate">
            Generel inflation
            <span className="ml-2 text-primary font-normal">
              {(input.inflationRate * 100).toFixed(1)}%
            </span>
          </Label>
          <Input
            id="inflationRate"
            type="range"
            min={0}
            max={0.1}
            step={0.005}
            value={input.inflationRate}
            onChange={(e) => onFieldChange('inflationRate', parseFloat(e.target.value))}
            className="h-2"
          />
          <div className="flex justify-between text-xs text-muted-foreground">
            <span>0%</span>
            <span>2% (standard)</span>
            <span>10%</span>
          </div>
        </div>

        <div className="space-y-2">
          <Label htmlFor="electricityInflationRate">
            Elpris-stigning
            <span className="ml-2 text-primary font-normal">
              {(input.electricityInflationRate * 100).toFixed(1)}%
            </span>
          </Label>
          <Input
            id="electricityInflationRate"
            type="range"
            min={0}
            max={0.15}
            step={0.005}
            value={input.electricityInflationRate}
            onChange={(e) => onFieldChange('electricityInflationRate', parseFloat(e.target.value))}
            className="h-2"
          />
          <div className="flex justify-between text-xs text-muted-foreground">
            <span>0%</span>
            <span>3% (standard)</span>
            <span>15%</span>
          </div>
          <p className="text-xs text-muted-foreground">
            Elpriser har historisk steget hurtigere end den generelle inflation
          </p>
        </div>

        <div className="space-y-2">
          <Label htmlFor="maintenanceCost">Årlig vedligeholdelse (DKK)</Label>
          <Input
            id="maintenanceCost"
            type="number"
            min={0}
            max={10000}
            value={input.maintenanceCostYear1}
            onChange={(e) => onFieldChange('maintenanceCostYear1', parseFloat(e.target.value) || 0)}
            placeholder="f.eks. 1000"
          />
          <p className="text-xs text-muted-foreground">
            Årlig inspektion, rengøring, og mindre reparationer. Typisk 500-2000 DKK.
          </p>
        </div>
      </div>

      {/* Assumptions summary */}
      <div className="rounded-md border-2 border-dashed p-4 space-y-3">
        <p className="text-sm font-medium">Faste antagelser (Phase 1)</p>
        <ul className="text-sm text-muted-foreground space-y-1">
          <li>• <span className="font-medium">Panel-degradering:</span> 3% første år (LID), derefter 0,5%/år</li>
          <li>• <span className="font-medium">Fremskrivningsperiode:</span> 25 år</li>
          <li>• <span className="font-medium">Afkast ved salg til net:</span> 80% af elpris</li>
        </ul>
        <p className="text-xs text-muted-foreground italic">
          Skattescenarier og finansieringsmuligheder kommer i fremtidige versioner.
        </p>
      </div>

      {/* Transparency note per FIN-06 */}
      <div className="rounded-md bg-amber-50 border border-amber-200 p-4 dark:bg-amber-950 dark:border-amber-800">
        <p className="text-sm text-amber-800 dark:text-amber-200">
          <span className="font-medium">Gennemsigtighed:</span> Alle beregninger bruger ovenstående antagelser.
          Du kan se de præcise formler under hver resultatsektion ved at klikke "Vis beregning".
        </p>
      </div>
    </div>
  );
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` - SystemTab and AdvancedTab compile without errors.
Run `npm run dev` and navigate to calculator - all 4 tabs render with inputs.
  </verify>
  <done>
System tab shows cost breakdown with VAT calculation and estimates based on roof area. Advanced tab allows customization of inflation and maintenance assumptions. All tabs use Danish labels and currency formatting.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. All 4 tabs (Essential, Energy, System, Advanced) render with proper Danish labels
3. Input changes trigger debounced API call (check network tab in browser devtools)
4. Validation errors display under invalid fields
5. Price area auto-detects from longitude
</verification>

<success_criteria>
- Tabbed interface with all calculator inputs organized logically
- Location input validates Danish coordinates
- Roof input has visual sliders with direction labels
- System cost shows transparent VAT breakdown
- Advanced tab exposes inflation and maintenance assumptions
- All inputs debounced at 500ms per DATA-03
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-core-calculations/01-05-SUMMARY.md`
</output>
